----item----
version: 1
id: {B6578E29-5717-4207-9F3D-FFBB9C583F91}
database: master
path: /sitecore/system/Modules/PowerShell/Script Library/Internal/Integrations/Content Editor Ribbon
parent: {9BE73650-A188-4802-A68E-E720DB54C5E9}
name: Content Editor Ribbon
master: {00000000-0000-0000-0000-000000000000}
template: {DD22F1B3-BD87-4DB2-9E7D-F7A496888D43}
templatekey: PowerShell Script

----field----
field: {06D5295C-ED2F-4A54-9BF2-26228D113318}
name: __Icon
key: __icon
content-length: 25

Control/16x16/toolbar.png
----version----
language: en
version: 1
revision: d11a2340-269a-4c4a-b75a-4dc5d6b217a3

----field----
field: {1C76313E-3C8C-4807-A826-135D10C39299}
name: ShowRule
key: showrule
content-length: 52

<?xml version="1.0" encoding="utf-16"?>
<ruleset />
----field----
field: {F62C67B4-28B6-4A6F-91CB-DB78CF054F4E}
name: EnableRule
key: enablerule
content-length: 52

<?xml version="1.0" encoding="utf-16"?>
<ruleset />
----field----
field: {B1A94FF0-6897-47C0-9C51-AA6ACB80B1F0}
name: Script
key: script
content-length: 2106

$scriptLibPath = "master:\system\Modules\PowerShell\Script Library\Content Editor\Ribbon"
$chunksPath = 'core:\content\Applications\Content Editor\Ribbons\Chunks\'

# Add new scripts to Control Panel
Get-Childitem $scriptLibPath | ForEach-Object {
    $library = $_;
    if($library.TemplateName -eq "PowerShell Script Library"){
        Get-Childitem $library.ProviderPath | ForEach-Object {
            $script = $_
            $chunk = Get-Item "$chunksPath/$($library.Name)"
            $button = Get-Item "$chunksPath/$($library.Name)/$($script.Name)"
            if($chunk -ne $null){
                # Cannot create chunks and associate them with ribbons yet
                if($button -eq $null){
                    $button = New-Item -path "$($chunk.ProviderPath)" -Name "$($script.Name)" -ItemType "/sitecore/templates/System/Ribbon/Large Button"
                    "Adding Script '$($script.Name)' to Chunk '$($chunk.Name)'."
                }
                else
                {
                    "Updating Script '$($script.Name)' in Chunk '$($chunk.Name)'."
                }
                $button.__Icon = $script.__Icon; 
                $button.Icon = $script.__Icon; 
                $button.Header = $script.Name;
                $button.__Sortorder = $script.__Sortorder;
                $button.Click = "item:executescript(id=`$Target,script=$($script.ID),scriptDb=$($script.Database.Name))"
            }
        }
    }
}

#Remove non existing scripts from Control Panel
Get-Childitem $chunksPath | ForEach-Object {
    $chunk = $_;
    Get-Childitem $_.ProviderPath | ForEach-Object {
        $button = $_
        if($button.Click -match "item:executescript"){
            $library = Get-Item "$scriptLibPath/$($chunk.Name)"
            $script = Get-Item "$scriptLibPath/$($chunk.Name)/$($button.Name)"
            if($library -eq $null -or $script -eq $null){
                "Removing button '$($button.Name)' from Chunk $($chunk.Name)' from Control Panel as the script no longer exists"
                $button | remove-item
            }
        }
    }
}
Close-Window
----field----
field: {25BED78C-4957-4165-998A-CA1B52F67497}
name: __Created
key: __created
content-length: 15

20131001T173321
----field----
field: {8CDC337E-A112-42FB-BBB4-4143751E123F}
name: __Revision
key: __revision
content-length: 36

d11a2340-269a-4c4a-b75a-4dc5d6b217a3
----field----
field: {D9CF14B1-FA16-4BA6-9288-E8A174D4D522}
name: __Updated
key: __updated
content-length: 34

20131001T183049:635162490496823516
----field----
field: {BADD9CF9-53E0-4D0C-BCC0-2D784C282F6A}
name: __Updated by
key: __updated by
content-length: 14

sitecore\admin
